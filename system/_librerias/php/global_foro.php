<?phpfunction SubComentario($forum_cod, $AlmacenPrograma, $AlmacenCurso, $Usuario,$IdREval) {    global $vConex;    $enlace = "./_vistas/gad_foro.php";    $Q_subcomentario = "SELECT         FD.Comentario,        FD.Participante,        FD.FechaHoraCreacion,        FD.Codigo,        FD.Estado         FROM forodet FD         INNER JOIN foro F ON FD.foro = F.Codigo         WHERE FD.foro = {$forum_cod}         ORDER BY FD.FechaHoraCreacion ASC ";            $MxSubcomentario = fetchAll($Q_subcomentario, $vConex);        foreach ($MxSubcomentario as $Subcomentario){        //Mostrando y validando si el subforo debe ser mostrado al Usuario        $show_subforum = false;                if($Subcomentario->Estado === "Publicado"){            $show_subforum = true;        }else if($Subcomentario->Estado === "Pendiente" && $Subcomentario->Participante === $Usuario){            $show_subforum = true;        }                if($show_subforum){            $Q_Usuario = "SELECT A.Nombres,A.ApellidosPat,A.ApellidoMat                         FROM alumnos A                         WHERE A.Usuario = '{$Subcomentario->Participante}Alumno'";            $ObjUsuario = fetchOne($Q_Usuario, $vConex);            $AutorDesc = "{$ObjUsuario->Nombres} {$ObjUsuario->ApellidosPat} {$ObjUsuario->ApellidoMat}";                        //Boton de publicacion            $btn = "";            if($Subcomentario->Estado == "Pendiente" && $Usuario === $Subcomentario->Participante){                $btn = "<div class='options'>                            <div class='btn' onclick=enviaVista('{$enlace}?Foro=public_comment&forum_cod={$forum_cod}&subforum_cod={$Subcomentario->Codigo}&AlmacenPrograma={$AlmacenPrograma}&AlmacenCurso={$AlmacenCurso}&forum_cod={$forum_cod}&IdREval={$IdREval}','SubComentario','');>Publicar <i class='icon-bullhorn'></i></div>                        </div>";            }            //Control para definir los puntos del subforo            $summary_point = summaryPoint_subforum($Subcomentario->Codigo);            $summary_point = (string) ($summary_point)? $summary_point : "null";                                            $Q_subforum_point = "SELECT Codigo, puntaje                                FROM foro_det_calificacion                                WHERE cod_foro_det = {$Subcomentario->Codigo}                                AND Participante = '{$Usuario}'";            $ObjSubforum_det = fetchOne($Q_subforum_point, $vConex);            $point = (string) ($ObjSubforum_det->puntaje)? $ObjSubforum_det->puntaje : "null";            $ctrl_point = " <div class='subforum_point' data-subforum={\"summary_point\":{$summary_point},\"point\":{$point},\"subforum_cod\":{$Subcomentario->Codigo}}></div>";                                        $date_string = FechaHoraText($Subcomentario->FechaHoraCreacion);                        $HTML .= "<div class='forum subforum' id='SubComentario-{$Subcomentario->Codigo}'>                        {$btn}                        <div class='photo'>                            <img src='/system/_imagenes/icon_user.png'/>                        </div>                        <div class='detail'>                            <div class='name_autor'>{$AutorDesc}</div>                            <div class='date'>{$date_string}</div>                            {$ctrl_point}                            <div class='desc'>{$Subcomentario->Comentario}</div>                            <div id='point_{$Subcomentario->Codigo}' class='point_indicator'></div>                        </div>                        <div class='clear'></div>                    </div>";        }    }        $HTML = "{$HTML}";    return $HTML;}function summaryPoint_subforum($subforum_cod){    global $vConex;        //Promedio de puntaje para el subforo    $Q_point_sum = "SELECT SUM(puntaje) AS num_point                    FROM foro_det_calificacion                    WHERE cod_foro_det = {$subforum_cod}";    $point_sum = (int) fetchOne($Q_point_sum, $vConex)->num_point;    $Q_point_count = "SELECT COUNT(*) AS num_point                    FROM foro_det_calificacion                    WHERE cod_foro_det = {$subforum_cod}";    $point_count = (int) fetchOne($Q_point_count, $vConex)->num_point;    return $point_sum / $point_count;}